{% extends 'base.html' %}

{% block content %}

<div class="text-center" style="font-family: 'Comic Sans MS', cursive;">
  <h3><b>Selected meals</b></h3>
</div>
<!--Using a jinja for loop, this will loop over each item returned from app.py-->
  <div class="container mb-4">
    <div class="row justify-content-center">
      {% for recipe in recipes %}
        <div class="col-12 col-md-6 col-lg-4 mb-3">
          <div class="card h-100 shadow-sm" style="border-radius: 12px; border: 1px solid rgba(0,0,0,0.08);">
            <div class="card-body text-center">
              <a href="{{ url_for('recipe', recipe_id=recipe.id) }}" style="text-decoration: none; color: inherit;">
                <h4 class="card-title mb-2" style="color: #2c3e50; font-weight: 600;">{{ recipe.name }}</h4>
              </a>
              <span class="badge" style="background-color: #3498db; color: white; font-size: 0.85rem; padding: 5px 10px; border-radius: 20px;">{{ recipe.cuisine }}</span>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>

    <div class="text-center" style="font-family: 'Comic Sans MS', cursive;">
      <h3><b>Shopping list</b></h3>
    </div>

    <table class="table table-striped table-bordered">

      <!--This will sort ingredients by category and list them accordingly-->
  <tbody>
        {% for category, ingredients in ingredients|groupby('category') %}
          <tr>
            <th>{{ category }}</th>
          </tr>
          {% for ingredient in ingredients %}
            {% if ingredient.id not in users_in_cart_items %}
              <tr class="swipe-row"
                  data-ingredient-id="{{ ingredient.id }}"
                  data-ingredient-inCart="{{ ingredient.in_cart }}"
                  data-quantity="{{ ingredient.quantity }}"
                  data-unit="{{ ingredient.unit }}"
                  data-name="{{ ingredient.name }}">
                <td>{{ ingredient.quantity }} {% if ingredient.unit != "item" %}{{ ingredient.unit }}{% endif %} {{ ingredient.name }}</td>
              </tr>
            {% endif %}
          {% endfor %}
        {% endfor %}
  </tbody>
    </table>

    <div class="text-center" style="font-family: 'Comic Sans MS', cursive;">
      <h3><b>In cart</b></h3>
    </div>
    <table class="table">
      <thead>
      <tr>
        <th scope="col">Quantity</th>
        <th scope="col">Name</th>
      </tr>
      </thead>
  <tbody id="in-cart-body">
      {% for category, ingredients in ingredients|groupby('category') %}
        {% for ingredient in ingredients %}
          {% if ingredient.id in users_in_cart_items %}
          <tr>
            <td>{{ ingredient.quantity }}</td>
            <td>{{ ingredient.name }}</td>
          </tr>
          {% endif %}
        {% endfor %}
      {% endfor %}
      </tbody>
    </table>

    <script src="{{ url_for('static', filename='js/internal/selected_recipes.js') }}"></script>

    <div style="position: relative; margin-top: 40px;">
      <input class="form-control form-control-sm" type="text" style="font-size: 0.75rem; height: 24px; border-radius: 4px; width: 135px;" placeholder="Meal Plan ID: {{  user_id  }}" readonly>
    </div>
{% endblock %}